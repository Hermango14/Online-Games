<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Catch the Box</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      touch-action: none;
    }

    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    #gameWrapper {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    canvas {
      border: 2px solid white;
      transform-origin: center center;
      touch-action: none;
    }

    button {
      padding: 15px 25px;
      font-size: 10px;
      margin-left: 10px;
    }

    button2 {
      padding: 20px 30px;
      font-size: 15px;
      margin-left: 10px;
    }

    #pauseBtn, #settingsBtn {
      position: fixed;
      top: 10px;
      z-index: 10;
    }

    #pauseBtn { left: 10px; }
    #settingsBtn { right: 10px; }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 20;
    }

    .menu {
      background: #222;
      padding: 20px;
      border-radius: 10px;
      width: 320px;
      text-align: center;
    }

    .close {
      float: right;
      cursor: pointer;
    }

    .colorBar {
      width: 200px;
      height: 20px;
      margin: 10px auto;
      border-radius: 10px;
      background: linear-gradient(to right, red, orange, yellow, green, cyan, blue, violet);
      position: relative;
      touch-action: none;
    }

    .colorPicker {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid white;
      position: absolute;
      top: 1px;
    }

    input[type=range] {
      width: 100%;
    }
  </style>
</head>
<body>

  <!-- Pause & Settings buttons -->
  <button id="pauseBtn" class="button2">Pause</button>
  <button id="settingsBtn">Settings</button>

  <!-- Game wrapper -->
  <div id="gameWrapper">
    <canvas id="game" width="400" height="600"></canvas>
  </div>

  <!-- MAIN MENU -->
  <div class="overlay" id="mainMenu" style="display:flex;">
    <div class="menu">
      <h2>Catch the Box</h2>
      <button onclick="startGame('default')">Default</button><br><br>
      <button onclick="startGame('normal')">Normal</button><br><br>
      <button onclick="startGame('hard')">Hard</button>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="overlay" id="settingsMenu">
    <div class="menu">
      <span class="close" onclick="closeSettings()">âœ–</span>
      <h3>Settings</h3>

      <!-- Zoom slider -->
      <p>Zoom</p>
      <input id="zoomSlider" type="range" min="0.5" max="2" step="0.05" value="1">
      <button onclick="resetZoom()">Default Zoom</button>

      <!-- Box color -->
      <p>Box Color</p>
      <div class="colorBar" data-target="box"><div class="colorPicker"></div></div>
      <p>Box Brightness</p>
      <input type="range" min="0" max="200" value="100" data-target="box" class="brightnessSlider">

      <!-- Paddle color -->
      <p>Paddle Color</p>
      <div class="colorBar" data-target="paddle"><div class="colorPicker"></div></div>
      <p>Paddle Brightness</p>
      <input type="range" min="0" max="200" value="100" data-target="paddle" class="brightnessSlider">

      <!-- Background color -->
      <p>Background Color</p>
      <div class="colorBar" data-target="bg"><div class="colorPicker"></div></div>
      <p>Background Brightness</p>
      <input type="range" min="0" max="200" value="100" data-target="bg" class="brightnessSlider">

      <!-- Text color -->
      <p>Text Color</p>
      <div class="colorBar" data-target="text"><div class="colorPicker"></div></div>
      <p>Text Brightness</p>
      <input type="range" min="0" max="200" value="100" data-target="text" class="brightnessSlider">
    </div>
  </div>

  <script>
    /* ---------- VARIABLES ---------- */
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const zoomSlider = document.getElementById("zoomSlider");

    let paddle, box, score;
    let gameState = "menu"; // menu | playing | paused | gameover
    let stateBeforeSettings = "menu";
    let mode = "normal";

    let boxColor = "#ff4d4d";
    let paddleColor = "#00ffee";
    let bgColor = "#222";
    let textColor = "white";

    let baseColors = { box: boxColor, paddle: paddleColor, bg: bgColor, text: textColor };
    let zoom = 1;
    let keys = {};
    let dragging = false;
    let highScore = Number(localStorage.getItem("highScore") || 0);
    let beatHighScore = false;

    /* ---------- GAME FUNCTIONS ---------- */
    function init() {
      paddle = { x: 160, y: 570, w: 80, h: 15, speed: 7 };
      box = { x: Math.random() * 370, y: 0, s: 30, speed: 2.5 };
      score = 0;
      beatHighScore = false;
    }

    function startGame(m) {
      mode = m;
      document.getElementById("mainMenu").style.display = "none";
      init();
      gameState = "playing";
    }

    function update() {
      // Movement keys
      if ((keys.ArrowLeft || keys.a) && paddle.x > 0) paddle.x -= paddle.speed;
      if ((keys.ArrowRight || keys.d) && paddle.x < canvas.width - paddle.w) paddle.x += paddle.speed;

      box.y += box.speed;

      if (box.y + box.s >= paddle.y &&
          box.x + box.s >= paddle.x &&
          box.x <= paddle.x + paddle.w) {
        score++;
        box.y = 0;
        box.x = Math.random() * (canvas.width - box.s);
        if (mode === "normal") box.speed += 0.15;
        if (mode === "hard") box.speed += 0.5;
      }

      if (box.y > canvas.height) {
        gameState = "gameover";
        if (score > highScore) {
          highScore = score;
          localStorage.setItem("highScore", highScore);
          beatHighScore = true;
        }
      }
    }

    function draw() {
      ctx.fillStyle = bgColor;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      if (gameState === "menu") return;

      ctx.fillStyle = paddleColor;
      ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);

      ctx.fillStyle = boxColor;
      ctx.fillRect(box.x, box.y, box.s, box.s);

      ctx.fillStyle = textColor;
      ctx.fillText("Score: " + score, 10, 30);
      ctx.fillText("High Score: " + highScore, 10, 55);

      if (gameState === "gameover") {
        ctx.fillText("GAME OVER", 105, 280);
        ctx.font = "20px Arial";
        ctx.fillText("Final Score: " + score, 125, 320);
        if (beatHighScore) {
          ctx.fillStyle = "yellow";
          ctx.fillText("You beat your high score!", 60, 355);
        }
        ctx.fillStyle = "white";
        ctx.fillText("Tap/click to restart", 90, 390);
      }

      if (gameState === "paused") {
        ctx.fillStyle = "yellow";
        ctx.font = "30px Arial";
        ctx.fillText("PAUSED", 145, 300);
      }
    }

    function loop() {
      if (gameState === "playing") update();
      draw();
      requestAnimationFrame(loop);
    }
    loop();

    /* ---------- POINTER HANDLING ---------- */
    function handlePointerStart(e) {
      e.preventDefault();
      const touchX = e.touches ? e.touches[0].clientX : e.clientX;

      if (gameState === "gameover") {
        gameState = "menu";
        document.getElementById("mainMenu").style.display = "flex";
        return;
      }

      if (gameState === "playing") {
        dragging = true;
        movePaddle(e);
      }
    }

    function handlePointerMove(e) {
      if (!dragging || gameState !== "playing") return;
      movePaddle(e);
    }

    function handlePointerEnd() {
      dragging = false;
    }

    function movePaddle(e) {
      const rect = canvas.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      let x = clientX - rect.left - paddle.w / 2;
      
      // Adjust for zoom
      x /= zoom;
      
      paddle.x = Math.max(0, Math.min(canvas.width - paddle.w, x));
    }

    canvas.addEventListener("mousedown", handlePointerStart);
    canvas.addEventListener("mousemove", handlePointerMove);
    canvas.addEventListener("mouseup", handlePointerEnd);
    canvas.addEventListener("touchstart", handlePointerStart);
    canvas.addEventListener("touchmove", handlePointerMove);
    canvas.addEventListener("touchend", handlePointerEnd);

    /* ---------- KEYBOARD CONTROL ---------- */
    document.addEventListener("keydown", e => {
      keys[e.key] = true;
      if (e.key.toLowerCase() === "e") {
        gameState = (gameState === "paused") ? "playing" : "paused";
      }
    });

    document.addEventListener("keyup", e => keys[e.key] = false);

    /* ---------- PAUSE BUTTON ---------- */
    document.getElementById("pauseBtn").onclick = () => {
      gameState = (gameState === "paused") ? "playing" : "paused";
    };

    /* ---------- SETTINGS ---------- */
    document.getElementById("settingsBtn").onclick = () => {
      stateBeforeSettings = gameState;
      gameState = "paused";
      document.getElementById("settingsMenu").style.display = "flex";
    };

    function closeSettings() {
      document.getElementById("settingsMenu").style.display = "none";
      gameState = stateBeforeSettings;
    }

    function resetZoom() {
      zoom = 1;
      zoomSlider.value = 1;
      canvas.style.transform = "scale(1)";
    }

    zoomSlider.addEventListener("input", e => {
      zoom = e.target.value;
      canvas.style.transform = `scale(${zoom})`;
    });

    /* ---------- COLOR PICKERS ---------- */
    document.querySelectorAll(".colorBar").forEach(bar => {
      bar.addEventListener("mousedown", pickColor);
      bar.addEventListener("touchstart", pickColor);

      function pickColor(e) {
        e.preventDefault();
        const picker = bar.querySelector(".colorPicker");
        const rect = bar.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const x = Math.max(0, Math.min(rect.width, clientX - rect.left));
        picker.style.left = (x - 8) + "px";

        const temp = document.createElement("canvas").getContext("2d");
        temp.canvas.width = rect.width;
        temp.canvas.height = 1;
        const g = temp.createLinearGradient(0, 0, rect.width, 0);
        ["red", "orange", "yellow", "green", "cyan", "blue", "violet"]
          .forEach((c, i) => g.addColorStop(i / 6, c));

        temp.fillStyle = g;
        temp.fillRect(0, 0, rect.width, 1);

        const d = temp.getImageData(x, 0, 1, 1).data;
        const color = `rgb(${d[0]},${d[1]},${d[2]})`;

        const target = bar.dataset.target;
        baseColors[target] = color;
        updateColor(bar, color);
      }
    });

    function updateColor(bar, color) {
      if (bar.dataset.target === "box") boxColor = color;
      if (bar.dataset.target === "paddle") paddleColor = color;
      if (bar.dataset.target === "bg") bgColor = color;
      if (bar.dataset.target === "text") textColor = color;
    }
  </script>
</body>
</html>
