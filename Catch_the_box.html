<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Catch the Box</title>

<style>
body {
  margin: 0;
  background: #111;
  color: white;
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  touch-action: none;
}

canvas {
  border: 2px solid white;
}

button {
  padding: 10px 20px;
  font-size: 16px;
}

#pauseBtn, #settingsBtn {
  position: absolute;
  top: 10px;
}

#pauseBtn { left: 10px; }
#settingsBtn { right: 10px; }

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: none;
  justify-content: center;
  align-items: center;
}

.menu {
  background: #222;
  padding: 20px;
  border-radius: 10px;
  width: 300px;
  text-align: center;
}

.close {
  float: right;
  cursor: pointer;
}

.colorBar {
  width: 200px;
  height: 20px;
  margin: 10px auto;
  border-radius: 10px;
  background: linear-gradient(to right, red, orange, yellow, green, cyan, blue, violet);
  position: relative;
  touch-action: none;
}

.colorPicker {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 2px solid white;
  position: absolute;
  top: 1px;
}
</style>
</head>

<body>

<button id="pauseBtn">Pause</button>
<button id="settingsBtn">Settings</button>
<canvas id="game" width="400" height="600"></canvas>

<!-- MAIN MENU -->
<div class="overlay" id="mainMenu" style="display:flex;">
  <div class="menu">
    <h2>Catch the Box</h2>
    <button onclick="startGame('default')">Default</button><br><br>
    <button onclick="startGame('normal')">Normal</button><br><br>
    <button onclick="startGame('hard')">Hard</button>
  </div>
</div>

<!-- SETTINGS -->
<div class="overlay" id="settingsMenu">
  <div class="menu">
    <span class="close" onclick="closeSettings()">âœ–</span>
    <h3>Settings</h3>

    <p>Box Color</p>
    <div class="colorBar" data-target="box"><div class="colorPicker"></div></div>

    <p>Paddle Color</p>
    <div class="colorBar" data-target="paddle"><div class="colorPicker"></div></div>

    <p>Background Color</p>
    <div class="colorBar" data-target="bg"><div class="colorPicker"></div></div>

    <p>Drag paddle to move</p>
  </div>
</div>

<script>
/* ---------- CANVAS ---------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ---------- STATE ---------- */
let gameState = "menu"; // menu | playing | paused | gameover
let stateBeforeSettings = "menu";
let mode = "normal";

/* ---------- OBJECTS ---------- */
let paddle, box, score;
let dragging = false;
const keys = {};

/* ---------- COLORS ---------- */
let boxColor = "#ff4d4d";
let paddleColor = "#00ffee";
let bgColor = "#222";

/* ---------- SCORE ---------- */
let highScore = Number(localStorage.getItem("highScore") || 0);
let beatHighScore = false;

/* ---------- INIT ---------- */
function init() {
  paddle = { x: 160, y: 570, w: 80, h: 15, speed: 7 };
  box = { x: Math.random() * 370, y: 0, s: 30, speed: 2.5 };
  score = 0;
  beatHighScore = false;
}

/* ---------- START GAME ---------- */
function startGame(m) {
  mode = m;
  document.getElementById("mainMenu").style.display = "none";
  init();
  gameState = "playing";
}

/* ---------- UPDATE ---------- */
function update() {
  if ((keys.ArrowLeft || keys.a) && paddle.x > 0) paddle.x -= paddle.speed;
  if ((keys.ArrowRight || keys.d) && paddle.x < canvas.width - paddle.w) paddle.x += paddle.speed;

  box.y += box.speed;

  if (
    box.y + box.s >= paddle.y &&
    box.x + box.s >= paddle.x &&
    box.x <= paddle.x + paddle.w
  ) {
    score++;
    box.y = 0;
    box.x = Math.random() * (canvas.width - box.s);
    if (mode === "normal") box.speed += 0.15;
    if (mode === "hard") box.speed += 0.5;
  }

  if (box.y > canvas.height) {
    gameState = "gameover";
    if (score > highScore) {
      highScore = score;
      localStorage.setItem("highScore", highScore);
      beatHighScore = true;
    }
  }
}

/* ---------- DRAW ---------- */
function draw() {
  ctx.fillStyle = bgColor;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  if (gameState === "menu") return;

  ctx.fillStyle = paddleColor;
  ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);

  ctx.fillStyle = boxColor;
  ctx.fillRect(box.x, box.y, box.s, box.s);

  ctx.fillStyle = "white";
  ctx.font = "18px Arial";
  ctx.fillText("Score: " + score, 10, 30);
  ctx.fillText("High Score: " + highScore, 10, 55);

  if (gameState === "paused") {
    ctx.fillStyle = "yellow";
    ctx.font = "30px Arial";
    ctx.fillText("PAUSED", 140, 300);
  }

  if (gameState === "gameover") {
    ctx.fillStyle = "red";
    ctx.font = "30px Arial";
    ctx.fillText("GAME OVER", 100, 280);
    ctx.font = "20px Arial";
    ctx.fillStyle = "white";
    ctx.fillText("Final Score: " + score, 120, 320);
    if (beatHighScore) {
      ctx.fillStyle = "yellow";
      ctx.fillText("New High Score!", 100, 350);
    }
    ctx.fillStyle = "white";
    ctx.fillText("Tap/click to return to menu", 50, 390);
  }
}

/* ---------- LOOP ---------- */
function loop() {
  if (gameState === "playing") update();
  draw();
  requestAnimationFrame(loop);
}
loop();

/* ---------- POINTER ---------- */
function handlePointerStart(e) {
  e.preventDefault();

  if (gameState === "gameover") {
    gameState = "menu";
    document.getElementById("mainMenu").style.display = "flex";
    return;
  }

  if (gameState !== "playing") return;

  dragging = true;
  const x = e.touches ? e.touches[0].clientX : e.clientX;
  movePaddle(x);
}

function handlePointerMove(e) {
  if (!dragging || gameState !== "playing") return;
  const x = e.touches ? e.touches[0].clientX : e.clientX;
  movePaddle(x);
}

function handlePointerEnd() {
  dragging = false;
}

function movePaddle(x) {
  const rect = canvas.getBoundingClientRect();
  paddle.x = x - rect.left - paddle.w / 2;
  paddle.x = Math.max(0, Math.min(canvas.width - paddle.w, paddle.x));
}

canvas.addEventListener("mousedown", handlePointerStart);
canvas.addEventListener("mousemove", handlePointerMove);
canvas.addEventListener("mouseup", handlePointerEnd);
canvas.addEventListener("touchstart", handlePointerStart);
canvas.addEventListener("touchmove", handlePointerMove);
canvas.addEventListener("touchend", handlePointerEnd);

/* ---------- KEYBOARD ---------- */
document.addEventListener("keydown", e => {
  keys[e.key] = true;
  if (e.key.toLowerCase() === "e") {
    if (gameState === "playing") gameState = "paused";
    else if (gameState === "paused") gameState = "playing";
  }
});
document.addEventListener("keyup", e => keys[e.key] = false);

/* ---------- SETTINGS ---------- */
document.getElementById("settingsBtn").onclick = () => {
  stateBeforeSettings = gameState;
  gameState = "paused";
  document.getElementById("settingsMenu").style.display = "flex";
};

function closeSettings() {
  document.getElementById("settingsMenu").style.display = "none";
  gameState = stateBeforeSettings;
}

/* ---------- PAUSE BUTTON ---------- */
document.getElementById("pauseBtn").onclick = () => {
  if (gameState === "playing") gameState = "paused";
  else if (gameState === "paused") gameState = "playing";
};

/* ---------- COLOR PICKERS (DRAGGABLE) ---------- */
document.querySelectorAll(".colorBar").forEach(bar => {
  let active = false;

  function updateColor(e) {
    if (!active) return;
    e.preventDefault();

    const rect = bar.getBoundingClientRect();
    const x = Math.max(
      0,
      Math.min(
        rect.width,
        (e.touches ? e.touches[0].clientX : e.clientX) - rect.left
      )
    );

    bar.querySelector(".colorPicker").style.left = (x - 8) + "px";

    const temp = document.createElement("canvas").getContext("2d");
    temp.canvas.width = rect.width;
    temp.canvas.height = 1;

    const g = temp.createLinearGradient(0, 0, rect.width, 0);
    ["red","orange","yellow","green","cyan","blue","violet"]
      .forEach((c,i)=>g.addColorStop(i/6,c));

    temp.fillStyle = g;
    temp.fillRect(0, 0, rect.width, 1);

    const d = temp.getImageData(x, 0, 1, 1).data;
    const color = `rgb(${d[0]},${d[1]},${d[2]})`;

    if (bar.dataset.target === "box") boxColor = color;
    if (bar.dataset.target === "paddle") paddleColor = color;
    if (bar.dataset.target === "bg") bgColor = color;
  }

  bar.addEventListener("mousedown", e => { active = true; updateColor(e); });
  bar.addEventListener("touchstart", e => { active = true; updateColor(e); });

  document.addEventListener("mousemove", updateColor);
  document.addEventListener("touchmove", updateColor);

  document.addEventListener("mouseup", () => active = false);
  document.addEventListener("touchend", () => active = false);
});
</script>

</body>
</html>
